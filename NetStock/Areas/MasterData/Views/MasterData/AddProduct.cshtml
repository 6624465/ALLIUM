@model NetStock.Contract.Product

@{
    ViewBag.Title = "Product Master";

    string str = "";
    if (Request["productCode"] != "NEW")
    {
        str = string.Format("Created By: {0} <br/> Created On: {1} <br/> Modified By: {2} <br/> Modified On: {3}", Model.CreatedBy, Model.CreatedOn, Model.ModifiedBy, Model.ModifiedBy.Length > 0 ? Model.ModifiedOn.ToString("dd/MM/yy HH:mm:ss") : "");
    }
}

<style type="text/css">
    .popover {
        width: 300px;
    }
</style>
@using (Html.BeginForm("AddProduct", "MasterData", FormMethod.Post, new { id = "myForm" }))
{
    <div class="box box-solid box-default">
        <div class="box-header with-border">
            @if (Request["productCode"] == "NEW")
            {
                <h3 class="box-title">Product Profile</h3>
            }
            else
            {
                <h3 class="box-title">Product Profile&nbsp;&nbsp;<a class="anchPopOverCss" data-container="body" data-toggle="popover" data-placement="right" data-content="@str" data-original-title="" title=""><i class="fa fa-tv" aria-hidden="true"></i></a></h3>
            }
        </div>
        <div class="box-body">
            <fieldset class="form-horizontal">
                <div class="form-group">

                    <div>
                        @Html.LabelFor(m => m.ProductCode, new { @class = "control-label input-sm col-md-2" })
                        <div class="col-md-2">
                            @Html.TextBoxFor(m => m.ProductCode, new { @class = "form-control input-sm ", maxlength = "50", @readonly = "readonly" })
                        </div>
                    </div>

                </div>
                <div class="form-group">
                    <div>
                        @Html.LabelFor(m => m.Description, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-4">
                            @Html.TextBoxFor(m => m.Description, new { @class = "form-control input-sm", @maxlength = "200", id = "txtProductDesc" })
                        </div>
                    </div>
                    <div>
                        @Html.LabelFor(m => m.Supplier1, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-2">
                            @Html.TextBoxFor(m => m.Supplier1, new { @class = "form-control input-sm" })
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div>
                        @Html.LabelFor(m => m.ProductCategory, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-4">
                            @Html.DropDownListFor(m => m.ProductCategory, Model.ProductCategoryList, "SELECT Category", new { @class = "input-sm form-control" })
                        </div>
                    </div>
                    <div>
                        @Html.LabelFor(m => m.Supplier2, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-2">
                            @Html.TextBoxFor(m => m.Supplier2, new { @class = "input-sm form-control" })
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div>
                        @Html.LabelFor(m => m.HSNCode, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-4">
                            @Html.TextBoxFor(m => m.HSNCode, new { @class = "form-control input-sm" })
                        </div>
                    </div>
                    <div>
                        @Html.LabelFor(m => m.Supplier3, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-2">
                            @Html.TextBoxFor(m => m.Supplier3, new { @class = "input-sm form-control" })
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div>
                        @Html.LabelFor(m => m.UOM, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-1">
                            @Html.DropDownListFor(m => m.UOM, Model.UOMList, "SELECT UOM", new { @class = "input-sm form-control" })
                        </div>
                    </div>
                    @*<div>
                        @Html.LabelFor(m => m.BuyingPrice, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-1">
                            @Html.TextBoxFor(m => m.BuyingPrice, new { @class = "form-control input-sm val decimalCss" })

                        </div>
                    </div>*@
                </div>
                @*<div class="form-group">
                        <div>
                            @Html.LabelFor(m => m.BuyingPrice, new { @class = "col-md-2 control-label input-sm",@type = "number" })
                            <div class="col-md-4">
                                @Html.TextBoxFor(m => m.BuyingPrice, new { type = "number",@class = "form-control input-sm val" })

                            </div>
                        </div>
                    </div>*@

                @*<div class="form-group">
                    <div>
                        @Html.LabelFor(m => m.IGST, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-1">
                            @Html.TextBoxFor(m => m.IGST, new { @class = "form-control input-sm val decimalCss" })
                        </div>
                    </div>
                    <div>
                        @Html.LabelFor(m => m.SGST, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-1">
                            @Html.TextBoxFor(m => m.SGST, new { @class = "form-control input-sm val decimalCss" })
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div>
                        @Html.LabelFor(m => m.CGST, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-1">
                            @Html.TextBoxFor(m => m.CGST, new { @class = "form-control input-sm val decimalCss" })
                        </div>
                    </div>
                    <div>
                        @Html.LabelFor(m => m.CESS, new { @class = "col-md-2 control-label input-sm" })
                        <div class="col-md-1">
                            @Html.TextBoxFor(m => m.CESS, new { @class = "form-control input-sm val decimalCss" })
                        </div>
                    </div>
                </div>*@
            </fieldset>

        </div>

        <div class="box-footer">
            <div class="row  no-print">
                <div class="col-xs-12">
                    @if (HtmlHelpers.hasRight("ProductsSave"))
                    {
                        <button type="button" id="btnSave45" onclick="btnSaveClick();" class="btn btn-primary btn-sm">
                            <i class="fa fa-save"></i>
                            Save
                        </button>
                    }
                    @if (HtmlHelpers.hasRight("ProductsDelete"))
                    {
                        <a href="#" id="btnDelete" onclick="DeleteProduct('@Model.ProductCode')" class="btn btn-sm btn-danger">
                            <i class="fa fa-times-circle"></i>
                            Delete
                        </a>
                    }
                    <a href="@Url.Action("AddProduct", "MasterData", new { area = "MasterData", ProductCode = "NEW" }, null)" class="btn btn-sm btn-default"><i class="fa fa-close"></i>Clear</a>
                    <a href="../MasterData/Products" class="btn btn-sm btn-info pull-right">
                        <i class="fa fa-arrow-circle-o-left"></i>
                        Back
                    </a>

                </div>
            </div>
        </div>

    </div>


}

@section Scripts {
    <script type="text/javascript">

        $(function () {
            $('[data-toggle="popover"]').popover({
                trigger: 'hover',
                html: true,
            });
            //$('#BuyingPrice').change(function (e) {
            //    var decimalRegexp = /^\d*(?:\.\d{1,2})?$/,
            //        num = e.currentTarget ? e.currentTarget.value : '';
            //    if (decimalRegexp.test(num) == false) {
            //        alert('Please enter only decimal numbers.');
            //        $('#BuyingPrice').val("");
            //        return false;
            //    }
            //});
            //$('#IGST').change(function (e) {
            //    var decimalRegexp = /^\d*(?:\.\d{1,2})?$/,
            //        num = e.currentTarget ? e.currentTarget.value : '';
            //    if (decimalRegexp.test(num) == false) {
            //        alert('Please enter only decimal numbers.');
            //        $('#IGST').val("");
            //        return false;
            //    }
            //});
            //$('#SGST').change(function (e) {
            //    var decimalRegexp = /^\d*(?:\.\d{1,2})?$/,
            //        num = e.currentTarget ? e.currentTarget.value : '';
            //    if (decimalRegexp.test(num) == false) {
            //        alert('Please enter only decimal numbers.');
            //        $('#SGST').val("");
            //        return false;
            //    }
            //});
            //$('#CGST').change(function (e) {
            //    var decimalRegexp = /^\d*(?:\.\d{1,2})?$/,
            //        num = e.currentTarget ? e.currentTarget.value : '';
            //    if (decimalRegexp.test(num) == false) {
            //        alert('Please enter only decimal numbers.');
            //        $('#CGST').val("");
            //        return false;
            //    }
            //});
            //$('#CESS').change(function (e) {
            //    var decimalRegexp = /^\d*(?:\.\d{1,2})?$/,
            //        num = e.currentTarget ? e.currentTarget.value : '';
            //    if (decimalRegexp.test(num) == false) {
            //        alert('Please enter only decimal numbers.');
            //        $('#CESS').val("");
            //        return false;
            //    }
            //});
            //$('input[type="text"]').val('');
           // $('.val').val('');
            $('#myForm').validate(
                {
                    rules: {
                        ProductCode: {
                            required: true
                        },
                        Description: {
                            required: true
                        },
                        ProductCategory: {
                            required: true
                        },
                        HSNCode: {
                            required: true
                        },
                        UOM: {
                            required: true
                        },
                        BuyingPrice: {
                            required: true
                        },
                        IGST: {
                            required: true
                        },
                        SGST: {
                            required: true
                        },
                        CGST: {
                            required: true
                        },
                        CESS: {
                            required: true
                        }
                    }
                });
        });

        function btnSaveClick() {
            
            if ($('#myForm').valid()) {
                var i = $('#ProductCategory').val();
                if (i != 'FINISHEDGOODS') {
                    var x = $('#Supplier1').val();
                    if (x == '') {
                        alert("SUPPLIER1 IS MANDATORY INCASE MATERIAL TYPE NOT EQAUL TO FINISHED GOOD");
                        //e.preventDefault();
                        return false;
                    }
                    else
                        $('#myForm').submit();
                }
                $('#myForm').submit();
            }
        }

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#target').attr('src', e.target.result);
                }

                reader.readAsDataURL(input.files[0]);
            }
        }




        $("#imgInp").change(function () {
            readURL(this);
        });
        //$(function () {
        //    $(".NumberAutonumeric").autoNumeric('init');
        //})


        $(document).ready(function () {
            //
            $("#ProductCode").focus();

            if ('@Model.Status' == 'False') {
                $("#Description").addClass("StrikeOut")
                $("#btnSave").attr("disabled", " disabled")
                $("#btnDelete").attr("disabled", " disabled")

            }

            var product = $("#ProductCode").val();
            if (product == "NEW") {
                $("#btnDelete").addClass('disabled')
            }
            else {
                $("#btnDelete").removeClass('disabled')
            }

        });


        function CheckValues() {

            var description = $("#Description").val();
            var barcode = $("#BarCode").val();


            if (description == "") {
                ModalShowConfirm("Product Description is REQUIRED!");
                return false;
            }

            if (barcode == "") {
                ModalShowConfirm("Product Bar-Code is REQUIRED!");
                return false;
            }



            return true;


        }

        function DeleteProduct() {

            var product = $("#ProductCode").val();
            var description = $("#Description").val();


            if (product == "NEW" || product == "") {
                ModalShowConfirm("Please choose a valid Product to Proceed!");
                return false;
            }


            if (!confirm("Do you want to delete Selected Product [" + description + "] ?")) {
                return false;
            }

            var rooturldelete = "@Url.Action("DeleteProduct", "MasterData", new { area = "MasterData" })"
            var urldelete = rooturldelete + "?productCode=" + product;

            var urlList = "@Url.Action("Products", "MasterData", new { area = "MasterData" })"

            //url: "/MasterData/DeleteProduct", type: "POST", dataType: "json",
            $.ajax({
                url: urldelete, type: "POST", dataType: "json",
                data: { productCode: product },
                async: true,
                success: function (response) {
                    if (response.result) {
                        ModalShow(response.Message, "Success", "Delete");
                        $("#txtDescription").addClass("StrikeOut")
                        $("#btnSave").attr("disabled", " disabled")
                        $("#btnDelete").attr("disabled", " disabled")

                    } else {
                        ModalShow(response.Message, "Failure", "Delete");
                    }
                    location.href = urlList;
                }
            })
        }

        function OnSaveFailure(result) {
            //
            ModalShow(result.Message, "Failure", "Save");
        }

        function OnSaveSuccess(result) {
            if (result.success == true) {
                ModalShow(result.Message, "Success", "Save");
                documentNo = result.POData.ProductCode;
                var urlList = "@Url.Action("Products", "MasterData", new { area = "MasterData" })"
                location.href = urlList;
            }
            else {
                ModalShow(result.Message, "Failure", "Save");
            }
        }


        function BtnOK() {
            if (ActionType == "Save") {

                //PrintClick(documentNo);
                var urlList = "@Url.Action("Products", "MasterData", new { area = "MasterData" })"

                if (ActionType == "Save") {
                    location.href = urlList;

                }
            }
        }



        //function txtOneChanged() {

        //    var changedText = $("#txtProductDesc").val();
        //    //var txtBox = document.getElementById('txtBarCode');
        //    $("#txtBarCode").val(changedText);


        //    //$.getJSON(
        //    //"/RMS_ITEM/ItemNameChanged", { "ChangedText": changedText },
        //    //function (myData) {
        //    //    txtBox.value = myData;
        //    //});
        //}

    </script>


}